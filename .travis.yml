sudo: true
dist: focal

services:
  - docker

before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

install:
  - docker-compose build

script:
  - docker-compose run --entrypoint="pytest tests" nycdb

jobs:
  include:
    - env:
        PYTHON_VERSION: 3.10-bullseye
        POSTGRES_VERSION: 14
    - env:
        PYTHON_VERSION: 3.10-bullseye
        POSTGRES_VERSION: 13
    - env:
        PYTHON_VERSION: 3.10-bullseye
        POSTGRES_VERSION: 12
    - env:
        PYTHON_VERSION: 3.9-bullseye
        POSTGRES_VERSION: 14
    - env:
        PYTHON_VERSION: 3.8-bullseye
        POSTGRES_VERSION: 14
    - env:
        PYTHON_VERSION: 3.7-bullseye
        POSTGRES_VERSION: 14
